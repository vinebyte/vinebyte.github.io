<!DOCTYPE html> <html> <head> <title>5311533生成二维码</title> <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script> </head> <body> <input type="text" id="refInput" placeholder="输入推广id，如0531pyq"> <button onclick="generateQRCode()">生成二维码海报</button> <button id="downloadButton" style="display:none;" onclick="downloadImages()">下载图片</button> <br><br> <canvas id="qrCodeCanvas" width="1560" height="1289"></canvas> <script> let qrCodeDataURL; function generateQRCode() { const refInput = document.getElementById('refInput'); const ref = refInput.value; const baseURL = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxa7e710795d5adeb3&redirect_uri=https%3A%2F%2Fh5.xiaoguai.net%2Flogin%3Fref%3D'; const url = baseURL + encodeURIComponent(ref) + '&response_type=code&scope=snsapi_base#wechat_redirect'; const typeNumber = 10; // 增加二维码的版本号 const errorCorrectionLevel = 'L'; // 设置纠错等级 const qr = qrcode(typeNumber, errorCorrectionLevel); qr.addData(url); qr.make(); const canvas = document.getElementById('qrCodeCanvas'); const ctx = canvas.getContext('2d'); const img = new Image(); img.onload = function() { ctx.drawImage(img, 0, 0); const qrCodeSize = 508; const qrCodeX = 74; const qrCodeY = 74; const qrCodeCanvas = document.createElement('canvas'); qrCodeCanvas.width = qrCodeSize; qrCodeCanvas.height = qrCodeSize; const qrCodeCtx = qrCodeCanvas.getContext('2d'); // 绘制白色背景 qrCodeCtx.fillStyle = '#FFFFFF'; qrCodeCtx.fillRect(0, 0, qrCodeSize, qrCodeSize); // 绘制二维码 const tileW = qrCodeSize / qr.getModuleCount(); const tileH = qrCodeSize / qr.getModuleCount(); for (let row = 0; row < qr.getModuleCount(); row++) { for (let col = 0; col < qr.getModuleCount(); col++) { qrCodeCtx.fillStyle = qr.isDark(row, col) ? '#000000' : '#FFFFFF'; qrCodeCtx.fillRect(col * tileW, row * tileH, tileW, tileH); } } ctx.drawImage(qrCodeCanvas, qrCodeX, qrCodeY); // 保存单独的二维码数据URL qrCodeDataURL = qrCodeCanvas.toDataURL('image/png'); // 显示下载按钮 document.getElementById('downloadButton').style.display = 'inline'; }; img.src = 'erwemaa.jpg'; // 确保图片路径正确 } function downloadImages() { // 下载含有二维码的海报图片 const canvas = document.getElementById('qrCodeCanvas'); const posterLink = document.createElement('a'); posterLink.href = canvas.toDataURL('image/png'); posterLink.download = 'qrcode_poster.png'; posterLink.click(); // 下载单独的二维码图片 const qrCodeLink = document.createElement('a'); qrCodeLink.href = qrCodeDataURL; qrCodeLink.download = 'qrcode.png'; qrCodeLink.click(); } </script> </body> </html>
